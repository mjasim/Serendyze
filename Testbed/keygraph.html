<!DOCTYPE html>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">


<style>
    .links line {
        stroke: #999;
        stroke-opacity: 0.6;
    }

    .nodes circle {
        stroke: #fff;
        stroke-width: 1.5px;
    }

    text {
        font-family: sans-serif;
        font-size: 10px;
    }

    .commentText:hover {
        background-color: lightgray;
        cursor: pointer;
    }
</style>
<link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
<!-- Latest compiled and minified CSS -->
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css">

<!-- jQuery library -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

<!-- Popper JS -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>

<!-- Latest compiled JavaScript -->
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js"></script>

<link rel="stylesheet" href="jquery.paginate.css">

<!-- CCrit -->
<!-- 
<div class="container" style="display:flex; flex-direction: column; align-items: center;">
    <div id="header" style="margin: 10px">
        <div class="w3-content">
            <div class="row">
                <div class="col-12">
                    <select id="area" name="area">
                        <option value="">Pick a Discussion</option>
                        <option value="0">Building a Tower</option>
                        <option value="1">Public Art</option>
                        <option value="2">Roundabout</option>
                        <option value="3">Huge Fountain</option>
                        <option value="4">Interactive Art</option>
                        <option value="5">El Parquecito</option>
                        <option value="6">Pedestrian Destination</option>
                        <option value="7">Promenade Real</option>
                        <option value="8">Platform Connected with Bridges</option>
                        <option value="9">Triangle Platform</option>
                        <option value="10">Zipline</option>
                        <option value="11">Transit Hub</option>
                        <option value="12">Gateway</option>
                        <option value="13">Connecing Past with Future</option>
                        <option value="14">Cart before the Horse</option>
                        <option value="15">Call the Area Something Else</option>
                        <option value="16">The Diamond</option>
                        <option value="17">The Lyre</option>
                        <option value="18">EV / Barrio Market</option>
                    </select>
                </div>
            </div>
        </div>
    </div> -->

<!-- Amazon -->
<div style="display:flex; flex-direction: column; align-items: center;">
    <div id="header" style="margin: 10px">
        <div class="w3-content">
            <div class="row">
                <div class="col-12">
                    <select id="area" name="area">
                        <option value="">Pick a Discussion</option>
                        <option value="0">Koss Porta Pro On Ear Headphones with Case, Black / Silver</option>
                        <option value="1">Sony MDRV6 Studio Monitor Headphones with CCAW Voice Coil</option>
                        <option value="2">Sennheiser HD280PRO Headphones (old model)</option>
                        <option value="3">Sennheiser RS120 On-Ear Wireless RF Headphones with Charging Dock</option>
                        <option value="4">Sony MDR7506 Professional Large Diaphragm Headphone</option>
                        <option value="5">Sennheiser HD 202 II Professional Headphones (Black)</option>
                        <option value="6">Sony MDREX10LP/BLK In-Ear Headphones</option>
                        <option value="7">Bose QuietComfort 15 Acoustic Noise Cancelling Headphones (Discontinued by
                            Manufacturer)</option>
                        <option value="8">Bose QuietComfort 25 Acoustic Noise Cancelling Headphones for Apple devices -
                            Black (wired, 3.5mm)</option>
                        <option value="9">Bluedio T2s Bluetooth Headphones On Ear with Mic, 57mm Driver Rotary Folding
                            Wireless Headset, Wired and Wireless
                            headphones for Cell Phone/TV/PC, 40 Hours Play Time (White)
                        </option>
                    </select>
                </div>
            </div>
        </div>
    </div>


    <div id="topicbox" style="display:flex; flex-direction: row; flex-wrap: wrap; align-items: center; margin:10px">
    </div>

    <div id="discbox" style="display:flex; flex-direction: row; flex-wrap: wrap; align-items: center; margin:10px">
    </div>

    <div id="alltextbox" style="display:flex; flex-direction: row; flex-wrap: wrap; align-items: center; margin:10px">
        <div id="textboxparent"
            style="display:flex; flex-direction: column; flex-wrap: wrap; align-items: center; margin:10px">
            <div id="textbox" style="margin: 10px; max-width: 80%; height: 40vh; overflow-y:auto"></div>
        </div>
        <div id="serenbox" style="margin: 10px; max-width: 0px; height: 0px; overflow-y:auto;"></div>
    </div>

    <div id="metricsbox" class="container" style="width:600px">
        <div style="border: solid thin lightgrey;">
            <div id="visitBar" class="w3-container w3-center" style="height:24px; width:0%; background-color: #b3e5fc;">
            </div>
        </div>
        <p id="vistext">Visit - You have looked at 0% comments</p>
        <div style="border: solid thin lightgrey;">
            <div id="coverageBar" class="w3-container w3-center"
                style="height:24px; width:0%; background-color: #c8e6c9; "></div>
        </div>
        <p id="covtext">Coverage - You know the contents of 0% comments</p>
        <div style="border: solid thin lightgrey;">
            <div id="distributionBar" class="w3-container w3-center"
                style="height:24px; width:0%; background-color: #ffcdd2;">
            </div>
        </div>
        <p id="disttext">Distribution - You haven't looked at any positive, negative, or neutral comments</p>
    </div>

    <div id="dice">
        <img src="dice.png" style="width: 50px; height:50px; margin:10px">
    </div>

    <!-- <div id="cordbox" style="display:flex; flex-direction: row; align-items: center; margin:10px">
        <div id="coordinate" style="margin-right: 10px"></div>
        <div id="timing" style="margin-left: 10px"></div>
    </div> -->

    <!-- <div id="serenbox" style="margin: 10px; width: 960px; height: 150px; overflow-y:auto"></div> -->

</div>

<script src="https://d3js.org/d3.v4.min.js"></script>
<script type="text/javascript" src="hilitor.js"></script>
<script src="jquery.paginate.js"></script>

<script>
    time_start = 0
    time_end = 0
    full_data = null;
    text_filter = "null"
    topic_filter = ""
    disc_filter = ""
    did = null
    selected_id_ngram = ""
    prev_selected_id_ngram = ""
    dc_array = []
    explored_list = []
    unexplored_list = []
    comment_id_list = []
    dice_trigger = 0
    for (var i = 0; i < 30; i++) {
        explored_list[i] = []
        unexplored_list[i] = []
        dc_array[i] = []
        comment_id_list[i] = []
    }

    // discourses_array = {
    //     "question": 0,
    //     "answer": 0,
    //     "announcement": 0,
    //     "elaboration": 0,
    //     "appreciation": 0,
    //     "agreement": 0,
    //     "disagreement": 0,
    //     "negativereaction": 0,
    //     "humor": 0,
    //     "other": 0
    // }

    myHilitor = ""

    discourses_array = []
    metrics = []

    for (var i = 0; i < 30; i++) {
        discourses_array[i] = {
            "Positive": 0,
            "Negative": 0,
            "Neutral": 0,
        }

        metrics[i] = {
            "coverage": 0,
            "visit": 0,
            "distribution": 0,
        }
    }

    // d3.json("mat_data_cc.json", function (error, data) {
    //     if (error) throw error;
    //     full_data = JSON.parse(JSON.stringify(data));
    // })

    d3.json("mat_data_amz.json", function (error, data) {
        if (error) throw error;
        full_data = JSON.parse(JSON.stringify(data));
        console.log(full_data)
    })

    function render_topics(discussion_id) {
        proposal_data = full_data[discussion_id]
        // console.log(proposal_data)
        var myNode = document.getElementById("topicbox");
        while (myNode.firstChild) {
            myNode.removeChild(myNode.firstChild);
        }

        // for (var i in proposal_data.topics) {
        //     // console.log(proposal_data.topics[i].topic_phrase)
        //     var divbutton = document.createElement("div")
        //     var buttonHTML = '<button type="button" class="btn btn-warning topicbtn" style="margin:5px">' +
        //         proposal_data.topics[i].topic_phrase + '</button>'
        //     divbutton.innerHTML = buttonHTML;
        //     myNode.appendChild(divbutton)
        // }

        for (var i in proposal_data.ngrams) {
            console.log(proposal_data.ngrams[i].ngram)
            var divbutton = document.createElement("div")
            var buttonHTML = '<button type="button" class="btn btn-warning topicbtn" id="ngram_' + i +
                '\" style="margin:5px">' +
                proposal_data.ngrams[i].ngram + '</button>'
            divbutton.innerHTML = buttonHTML;
            myNode.appendChild(divbutton)
        }
    }

    function render_discourse(discussion_id) {
        proposal_data = full_data[discussion_id]
        // console.log(proposal_data.discourses)
        var myNode = document.getElementById("discbox");
        while (myNode.firstChild) {
            myNode.removeChild(myNode.firstChild);
        }

        for (var i in proposal_data.discourses) {
            // console.log(proposal_data.discourses[i].discourse_name)
            var divbutton = document.createElement("div")
            var buttonHTML = '<button type="button" class="btn btn-success discbtn" id="discourse_' +
                i + '\" style="margin:5px">' +
                proposal_data.discourses[i].discourse_name + '</button>'
            divbutton.innerHTML = buttonHTML;
            myNode.appendChild(divbutton)
        }
    }

    function render_text(text_filter) {
        console.log("here")
        // if (disc_filter) {
        //     text_filter = text_filter.substring(0, text_filter.indexOf(':'))
        // }

        proposal_data = full_data[did]
        console.log(proposal_data, disc_filter, topic_filter, text_filter)
        var myNode = document.getElementById("textbox");
        while (myNode.firstChild) {
            myNode.removeChild(myNode.firstChild);
        }

        for (var i in proposal_data.comments) {

            if (topic_filter && disc_filter) {
                var tokens = proposal_data.comments[i].comment.toLowerCase().split(" ");

                if ((tokens.includes(topic_filter.split(" ")[0]) || tokens.includes(topic_filter.split(" ")[1])) &&
                    disc_filter == proposal_data.comments[i].discourse) {

                    divSum = document.createElement("div")

                    var divHTML =
                        '<div style=\"margin:3px; display:flex; flex-direction: row; align-items: flex-start\">' +
                        '<span ' +
                        ' style=\"background-color:lightgray; padding-left:10px; padding-right:10px; border-radius:10 px;\">' +
                        proposal_data.comments[i].discourse + '</span>' + "\xa0\xa0\xa0" +
                        '<p class="commentText" id="comment_' + proposal_data.comments[i].comment_id + '">' +
                        proposal_data.comments[i].comment + '</p> </div>'
                    divSum.innerHTML = divHTML;
                    myNode.appendChild(divSum)

                    if (comment_id_list[did].includes(proposal_data.comments[i].comment_id)) {
                        console.log("here")
                        document.getElementById("comment_" + proposal_data.comments[i].comment_id).setAttribute(
                            "style",
                            "background-color: #E0F9C9")
                    }
                }


            } else if (topic_filter && !disc_filter) {
                // if (text_filter == proposal_data.comments[i].topic_phrase) {
                //     divSum = document.createElement("div")

                //     var divHTML =
                //         '<div style=\"margin:3px; display:flex; flex-direction: row; align-items: flex-start\">' +
                //         '<span ' +
                //         'style=\"background-color:lightgray; padding-left:10px; padding-right:10px; border-radius:10px;\">' +
                //         proposal_data.comments[i].discourse + '</span>' + "\xa0\xa0\xa0" +
                //         '<div class="commentText" id="comment_' + i + '">' + proposal_data.comments[i].comment +
                //         '</div></div>'
                //     divSum.innerHTML = divHTML;
                //     myNode.appendChild(divSum)
                // }

                var tokens = proposal_data.comments[i].comment.toLowerCase().split(" ");

                if ((tokens.includes(topic_filter.split(" ")[0]) || tokens.includes(topic_filter.split(" ")[1]))) {
                    // || (proposal_data.comments[i].lemmas.includes(text_filter.split(" ")[0]) || proposal_data.comments[i].lemmas.includes(text_filter.split(" ")[1]))) 

                    divSum = document.createElement("div")

                    var divHTML =
                        '<div style=\"margin:3px; display:flex; flex-direction: row;  align-items: flex-start\">' +
                        '<span ' +
                        ' style=\"background-color:lightgray; padding-left:10px; padding-right:10px; border-radius: 10px;\">' +
                        proposal_data.comments[i].discourse + '</span>' + "\xa0\xa0\xa0" +
                        '<p class="commentText" id="comment_' + proposal_data.comments[i].comment_id + '">' +
                        proposal_data.comments[i].comment +
                        '</p></div>'
                    divSum.innerHTML = divHTML;
                    myNode.appendChild(divSum)

                    if (comment_id_list[did].includes(proposal_data.comments[i].comment_id)) {
                        console.log("here")
                        document.getElementById("comment_" + proposal_data.comments[i].comment_id).setAttribute(
                            "style",
                            "background-color: #E0F9C9")
                    }
                }

                // if (text_filter == proposal_data.ngrams[i].ngram) {
                //     divSum = document.createElement("div")

                //     var divHTML =
                //         '<div style=\"margin:3px; display:flex; flex-direction: row; align-items: flex-start\">' +
                //         '<span ' +
                //         ' style=\"background-color:lightgray; padding-left:10px; padding-right:10px; border - radius: 10 px;\">' +
                //         proposal_data.comments[i].discourse + '</span>' + "\xa0\xa0\xa0" +
                //         '<div class="commentText" id="comment_' + proposal_data.comments[i].comment_id + '">' + proposal_data.comments[i].comment +
                //         '</div></div>'
                //     divSum.innerHTML = divHTML;
                //     myNode.appendChild(divSum)
                // }
            } else if (disc_filter && !topic_filter) {
                if (disc_filter == proposal_data.comments[i].discourse) {
                    divSum = document.createElement("div")
                    // var divHTML =
                    //     '<div class="commentText" style=\"margin:3px; display:flex; flex-direction: row; align-items: flex-start\">' +
                    //     proposal_data.comments[i].comment + '</div>'

                    var divHTML =
                        '<div style=\"margin:3px; display:flex; flex-direction: row;  align-items: flex-start\">' +
                        '<span ' +
                        'style=\"background-color:lightgray; padding-left:10px; padding-right:10px; border-radius:10px;\">' +
                        proposal_data.comments[i].discourse + '</span>' + "\xa0\xa0\xa0" +
                        '<p class="commentText" id="comment_' + proposal_data.comments[i].comment_id + '">' +
                        proposal_data.comments[i].comment +
                        '</p></div>'
                    divSum.innerHTML = divHTML;
                    myNode.appendChild(divSum)

                    if (comment_id_list[did].includes(proposal_data.comments[i].comment_id)) {
                        console.log("here")
                        document.getElementById("comment_" + proposal_data.comments[i].comment_id).setAttribute(
                            "style",
                            "background-color: #E0F9C9")
                    }
                }
            } else if (!text_filter) {
                divSum = document.createElement("div")
                var divHTML =
                    '<div style=\"margin:3px; display:flex; flex-direction: row;  align-items: flex-start\">' +
                    '<span ' +
                    'style=\"background-color:lightgray; padding-left:10px; padding-right:10px; border-radius:10px;\">' +
                    proposal_data.comments[i].discourse + '</span>' + "\xa0\xa0\xa0" +
                    '<p class="commentText" id="comment_' + proposal_data.comments[i].comment_id + '">' +
                    proposal_data.comments[i].comment +
                    '</p></div>'
                divSum.innerHTML = divHTML;
                myNode.appendChild(divSum)

                if (comment_id_list[did].includes(proposal_data.comments[i].comment_id)) {
                    console.log("here")
                    document.getElementById("comment_" + proposal_data.comments[i].comment_id).setAttribute(
                        "style",
                        "background-color: #E0F9C9")
                }
            }
        }

        do_pagination()
    }

    function move(bar_id, max_len) {
        var elem = document.getElementById(bar_id);
        var width = 0

        if (bar_id == "coverageBar") {
            width = metrics[did].coverage
        } else if (bar_id == "distributionBar") {
            width = metrics[did].distribution
        } else {
            width = metrics[did].visit
        }

        // console.log(width, max_len)
        var id = setInterval(frame, 10);

        function frame() {
            if (width >= max_len) {
                clearInterval(id);
            } else {
                width = width + 1;
                elem.style.width = width + '%';
                elem.innerHTML = '<b>' + ' ' + width * 1 + '%'
                '</b>';
            }

            if (bar_id == "coverageBar") {
                metrics[did].coverage = width
                document.getElementById("covtext").innerHTML = 'Coverage - You know the content of ' + width * 1 +
                    '% comments';
            } else if (bar_id == "distributionBar") {
                metrics[did].distribution = width
                document.getElementById("disttext").innerHTML = 'Distribution - ' + width * 1 + '%';
            } else {
                metrics[did].visit = width
                document.getElementById("vistext").innerHTML = 'Visit - You have looked at ' + width * 1 +
                    '% comments';
            }
        }
    }

    function refresh_move(bar_id) {
        var elem = document.getElementById(bar_id);
        // elem.style.width = '0%';
        // elem.innerHTML = "";
        if (bar_id == "coverageBar") {
            width = metrics[did].coverage
            document.getElementById("covtext").innerHTML = 'Coverage - You know the content of ' + width * 1 +
                '% comments';
        } else if (bar_id == "distributionBar") {
            width = metrics[did].distribution
            document.getElementById("disttext").innerHTML = 'Distribution ' + width * 1 + '%';
        } else {
            width = metrics[did].visit
            document.getElementById("vistext").innerHTML = 'Visit - You have looked at ' + width * 1 +
                '% comments';
        }

        elem.style.width = width + '%';
    }

    function get_visit() {
        var cnt = 0
        for (var i in dc_array[did]) {
            if (dc_array[did][i] == 1) {
                cnt = cnt + 1
            }
        }
        console.log((cnt / dc_array[did].length) * 100)
        move("visitBar", (cnt / dc_array[did].length) * 100);
    }

    function get_distribution() {
        var active_cnt = 0
        var perc_per_discourse = 0
        var cnt = 0
        proposal_disc = full_data[did].discourses
        // console.log(proposal_disc)
        for (var i in proposal_disc) {
            if (proposal_disc[i].count > 0) {
                active_cnt += 1
            }
        }
        active_cnt = 100 / active_cnt

        console.log(active_cnt)

        for (var i in proposal_disc) {
            if (proposal_disc[i].count > 0) {
                perc_per_discourse += (discourses_array[did][proposal_disc[i].discourse_name] / proposal_disc[i]
                        .count) *
                    active_cnt

                console.log(perc_per_discourse)
            }
        }
        move("distributionBar", perc_per_discourse);
    }

    function get_coverage(disc_comments) {

        // for (var i in disc_comments) {
        //     for (var j in explored_list) {
        //         if (disc_comments[i].comment != explored_list[j])
        //             unexplored_list.push(disc_comments[i].comment)
        //     }
        // }

        console.log(explored_list[did], unexplored_list[did])

        $.ajax({
            type: "POST",
            url: "http://mjasim.pythonanywhere.com/",
            data: JSON.stringify({
                explored: explored_list[did],
                unexplored: unexplored_list[did]
            }),
            contentType: 'application/json;charset=UTF-8',
            success: function (data, status) {
                console.log(data, status);
                var myNode = document.getElementById("serenbox");
                while (myNode.firstChild) {
                    myNode.removeChild(myNode.firstChild);
                }

                divSum = document.createElement("div")
                var divHTML = '<div class="serenText" id="comment_' + '0' +
                    '"style=" margin-bottom: 10px">' + '>>' +
                    data[1][0]
                    .text +
                    '</div>' +
                    '<div class="serenText" id="comment_' + '1' + '"style="margin-bottom: 10px">' +
                    '>> ' +
                    data[1][1].text +
                    '</div>' +
                    '<div class="serenText" id="comment_' + '2' + '" style="margin-bottom: 10px">' +
                    '>> ' +
                    data[1][2].text +
                    '</div>';

                divSum.innerHTML = divHTML;
                myNode.appendChild(divSum)

                move("coverageBar", ((explored_list[did].length + data[0].length) / disc_comments
                        .length) *
                    100);
            }
        });

        // $.post("http://mjasim.pythonanywhere.com/", JSON.stringify({
        //         query: text,
        //         comments: comments
        //     }),
        //     function (data, status) {
        //         console.log(data, status);
        //     });
    }

    $(document).ready(function () {
        $('#area').change(function () {
            var discussion_id = $("#area").val();
            $("#mainSVG").empty();
            render_topics(discussion_id)
            render_discourse(discussion_id)

            var myNode = document.getElementById("textbox");
            while (myNode.firstChild) {
                myNode.removeChild(myNode.firstChild);
            }

            did = discussion_id

            selected_id_ngram = ""
            prev_selected_id_ngram = ""

            selected_id_disc = ""
            prev_selected_id_disc = ""

            console.log(did)

            // metrics.coverage = 0
            // metrics.visit = 0
            // metrics.distribution = 0
            // metrics.depth = 0

            // discourses_array.question = 0
            // discourses_array.answer = 0
            // discourses_array.announcement = 0
            // discourses_array.elaboration = 0
            // discourses_array.appreciation = 0
            // discourses_array.agreement = 0
            // discourses_array.disagreement = 0
            // discourses_array.negativereaction = 0
            // discourses_array.humor = 0
            // discourses_array.other = 0

            // discourses_array.positive = 0
            // discourses_array.negative = 0
            // discourses_array.neutral = 0

            topic_filter = ""
            disc_filter = ""
            text_filter = ""

            // explored_list = []

            for (var i in full_data[did].comments) {
                unexplored_list[did].push(full_data[did].comments[i].comment)
            }

            if (dc_array[did].length < 1) {
                dc_array[did] = new Array(full_data[did].comments.length)
            }

            console.log("dc_array", dc_array[did])

            refresh_move("coverageBar")
            refresh_move("distributionBar")
            refresh_move("visitBar")

            render_text(text_filter)
        });
    });

    $(document).on('click', '.topicbtn', function () {
        console.log($(this)[0].innerText)
        topic_filter = $(this)[0].innerText

        selected_id_ngram = $(this)[0].id
        // if (selected_id_disc) {
        //     document.getElementById(selected_id_disc).setAttribute("style", "border: solid thick white")
        //     selected_id_disc = ""
        //     prev_selected_id_disc = ""
        // }

        console.log(selected_id_ngram, prev_selected_id_ngram, selected_id_disc, prev_selected_id_disc)

        if (prev_selected_id_ngram == selected_id_ngram) {
            document.getElementById(selected_id_ngram).setAttribute("style", "border: solid thick white")
            selected_id_ngram = ""
            prev_selected_id_ngram = ""
            topic_filter = ""
            if (selected_id_disc) {
                console.log("discsdics - ", $("#" + selected_id_disc)[0].innerText)
                render_text($("#" + selected_id_disc)[0].innerText)
            } else {
                render_text("")
            }
        } else {
            document.getElementById(selected_id_ngram).setAttribute("style", "border: solid thick black")
            if (prev_selected_id_ngram) {
                document.getElementById(prev_selected_id_ngram).setAttribute("style",
                    "border: solid thick white")
            }
            prev_selected_id_ngram = selected_id_ngram
            console.log($(this)[0].innerText)
            render_text($(this)[0].innerText)

            myHilitor = new Hilitor("textbox");
            myHilitor.apply(topic_filter);
        }
    });

    $(document).on('click', '.discbtn', function () {
        console.log($(this)[0].innerText)
        disc_filter = $(this)[0].innerText
        console.log("click", disc_filter)

        selected_id_disc = $(this)[0].id
        // if (selected_id_ngram) {
        //     document.getElementById(selected_id_ngram).setAttribute("style", "border: solid thick white")
        //     selected_id_ngram = ""
        //     prev_selected_id_ngram = ""
        // }

        console.log(selected_id_disc, prev_selected_id_disc)

        if (prev_selected_id_disc == selected_id_disc) {
            document.getElementById(selected_id_disc).setAttribute("style", "border: solid thick white")
            selected_id_disc = ""
            prev_selected_id_disc = ""

            disc_filter = ""
            if (selected_id_ngram) {
                render_text($("#" + selected_id_ngram)[0].innerText)
            } else {
                render_text("")
            }

            if (topic_filter) {
                myHilitor = new Hilitor("textbox");
                myHilitor.apply(topic_filter);
            }

        } else {
            document.getElementById(selected_id_disc).setAttribute("style", "border: solid thick black")
            if (prev_selected_id_disc) {
                document.getElementById(prev_selected_id_disc).setAttribute("style",
                    "border: solid thick white")
            }
            prev_selected_id_disc = selected_id_disc
            render_text($(this)[0].innerText)
            console.log($(this)[0].innerText)

            if (topic_filter) {
                myHilitor = new Hilitor("textbox");
                myHilitor.apply(topic_filter);
            }
        }

    });

    function comment_interact(id) {
        var text = ""
        console.log("inside comment intr --", id)
        for (var i in full_data[did].comments) {
            if (full_data[did].comments[i].comment_id.toString() == id) {
                text = full_data[did].comments[i].comment
                console.log(text)
                if (!dc_array[did][i]) {
                    dc_array[did][i] = 1
                    discourses_array[did][full_data[did].comments[i].discourse] += 1
                }
                comment_id_list[did].push(full_data[did].comments[i].comment_id)
                document.getElementById("comment_" + full_data[did].comments[i].comment_id).setAttribute(
                    "style",
                    "background-color: #E0F9C9")
            }
        }

        explored_list[did].push(text)

        for (var i in unexplored_list[did]) {
            if (unexplored_list[did][i] == text) {
                unexplored_list[did].splice(i, 1)
            }
        }

        get_distribution()
        get_coverage(full_data[did].comments)
        get_visit()
    }

    function isScrolledIntoView(elem) {
        var docViewTop = $('#textbox').scrollTop();
        var docViewBottom = docViewTop + $('#textbox').height();

        var elemTop = $(elem).offset().top;
        var elemBottom = elemTop + $(elem).height();

        return ((elemBottom <= docViewBottom) && (elemTop >= docViewTop));
    }

    function do_pagination() {

        if (document.getElementById("paginatepage")) {
            var myNode = document.getElementById("paginatepage");
            while (myNode.firstChild) {
                myNode.removeChild(myNode.firstChild);
            }

            $('#textbox').unbind().removeData();
        }

        $('#textbox').paginate({
            scope: $('div'), // targets all div elements
            autoScroll: true,
            perPage: 100
        })

        $('#textbox').animate({
            scrollTop: "0"
        }, 1000)
    }


    $(document).on('click', '.commentText', function () {
        // console.log($(this)[0].innerText)
        // comment_interact($(this)[0].innerText)
        comment_interact($(this)[0].id.substring(8))
        // document.getElementById("timing").innerText = " clicked - " + $(this)[0].innerText
    });

    $(document).on('mouseover', '.topicbtn, .discbtn, .commentText', function () {
        time_start = Date.now();
        // console.log($(this)[0].innerText, start)
    });

    $(document).on('mouseout', '.topicbtn, .discbtn, .commentText', function () {
        time_end = Date.now();
        var elapsed_time = ((time_end - time_start) / 1000)
        // console.log(elapsed_time, $(this)[0].innerText)
        if (this.className == 'commentText' && elapsed_time > 2) {
            comment_interact($(this)[0].id.substring(8))
        }
        // document.getElementById("timing").innerText = "hovered " + elapsed_time + " s over " + $(this)[
        //         0]
        //     .innerText
    });

    // $(document).on('mousemove', function () {
    //     document.getElementById("coordinate").innerText = event.pageX + ", " + event.pageY
    // });

    $(document).on('click', "#dice", function () {
        if (dice_trigger == 0 && document.getElementById("serenbox").hasChildNodes()) {
            dice_trigger = 1
            document.getElementById("serenbox").setAttribute("style",
                "margin: 10px; max-width: 40%; height: 40vh; overflow-y:auto;")
            document.getElementById("textbox").setAttribute("style",
                "margin: 10px; max-width: 40%; height: 40vh; overflow-y:auto;")
        } else {
            dice_trigger = 0
            document.getElementById("serenbox").setAttribute("style",
                "margin: 10px; width: 0px; height: 0px; overflow-y:auto;")
            document.getElementById("textbox").setAttribute("style",
                "margin: 10px; max-width: 80%; height: 40vh; overflow-y:auto;")
        }
    });

    $('#textbox').on('scroll', function () {
        var x = document.getElementById("textbox").childNodes

        var ids = $('#textbox .commentText').map(function () {
            return $(this).attr('id');
        }).get();
        for (var i in ids) {
            if ((isScrolledIntoView("#" + ids[i]))) {
                // console.log(ids[i])
            }
        }
    });
</script>