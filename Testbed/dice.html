<!DOCTYPE html>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">


<style>
    .links line {
        stroke: #999;
        stroke-opacity: 0.6;
    }

    .nodes circle {
        stroke: #fff;
        stroke-width: 1.5px;
    }

    text {
        font-family: sans-serif;
        font-size: 10px;
    }

    .commentText:hover {
        background-color: lightgray;
        cursor: pointer;
    }

    .serenText:hover {
        background-color: lightgray;
        cursor: pointer;
    }

    .topicbtn:hover {
        /* background-color: #ff6 !important; */
        border: solid 2px goldenrod !important;
        cursor: pointer !important;
    }

    .discbtn:hover {
        /* background-color: #ff6 !important; */
        border: solid 2px goldenrod !important;
        cursor: pointer;
    }

    .loader {
        border: 10px solid #b3e5fc;
        border-radius: 50%;
        border-top: 10px solid black;
        width: 10px;
        height: 10px;
        -webkit-animation: spin 2s linear infinite;
        /* Safari */
        animation: spin 2s linear infinite;
    }

    .metbar:hover {
        cursor: pointer;
    }

    /* Safari */
    @-webkit-keyframes spin {
        0% {
            -webkit-transform: rotate(0deg);
        }

        100% {
            -webkit-transform: rotate(360deg);
        }
    }

    @keyframes spin {
        0% {
            transform: rotate(0deg);
        }

        100% {
            transform: rotate(360deg);
        }
    }
</style>
<link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
<!-- Latest compiled and minified CSS -->
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css">

<!-- jQuery library -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

<!-- Popper JS -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>

<!-- Latest compiled JavaScript -->
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js"></script>

<link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet">

<link rel="stylesheet" href="jquery.paginate.css">

<!-- CCrit -->
<!-- 
<div class="container" style="display:flex; flex-direction: column; align-items: center;">
    <div id="header" style="margin: 10px">
        <div class="w3-content">
            <div class="row">
                <div class="col-12">
                    <select id="area" name="area">
                        <option value="">Pick a Discussion</option>
                        <option value="0">Building a Tower</option>
                        <option value="1">Public Art</option>
                        <option value="2">Roundabout</option>
                        <option value="3">Huge Fountain</option>
                        <option value="4">Interactive Art</option>
                        <option value="5">El Parquecito</option>
                        <option value="6">Pedestrian Destination</option>
                        <option value="7">Promenade Real</option>
                        <option value="8">Platform Connected with Bridges</option>
                        <option value="9">Triangle Platform</option>
                        <option value="10">Zipline</option>
                        <option value="11">Transit Hub</option>
                        <option value="12">Gateway</option>
                        <option value="13">Connecing Past with Future</option>
                        <option value="14">Cart before the Horse</option>
                        <option value="15">Call the Area Something Else</option>
                        <option value="16">The Diamond</option>
                        <option value="17">The Lyre</option>
                        <option value="18">EV / Barrio Market</option>
                    </select>
                </div>
            </div>
        </div>
    </div> -->

<!-- Amazon -->

<nav class="navbar navbar-expand-lg navbar-dark bg-dark py-0">
    <a class="navbar-brand" href="#" onclick="reload_page()" title="Refresh Page and Start Over">
        <img src="dice.png" width="30" height="30" alt="">
        DICE
    </a>
    <button class="navbar-toggler py-0" type="button" data-toggle="collapse" data-target="#navbarSupportedContent"
        aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon py-0"></span>
    </button>

    <div class="collapse navbar-collapse py-0" id="navbarSupportedContent">
        <ul class="navbar-nav mr-auto py-0">
            <li class="nav-item active py-0">
                <a class="nav-link py-0" href="#" onclick="gototutorial()" title="User Guide">Tutorial<span
                        class="sr-only py-0">(current)</span></a>
            </li>
            <li class="nav-item py-0">
                <a class="nav-link py-0" href="#" data-toggle="modal" data-target="#aboutModal" title="About">About</a>
            </li>
        </ul>
    </div>
</nav>

<!-- <div class="modal fade bd-example-modal-lg" id="userModal" tabindex="-1" role="dialog" aria-labelledby="userModalLabel"
    aria-hidden="true">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="userModalLabel">Welcome to Dice</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <p>Select a product from the dropdown, then explore product comments to make a purchase decision. You
                    can mark comments as read by clicking on the comment.</p>
                <div style="display: flex; flex-direction: column; justify-content: flex-start;">
                    <div style="display: flex; flex-direction: row; justify-content: flex-start;">
                        <div
                            style="display: block; width: 100px; height: 24px; margin: 5px; background-color: #b3e5fc;">
                        </div>
                        <div style="display: block; width: 900px; height: 50px; margin: 5px;">The Visit bar shows how
                            many comments you interacted with.</div>
                    </div>
                    <div style="display: flex; flex-direction: row; justify-content: flex-start;">
                        <div
                            style="display: block; width: 100px; height: 24px; margin: 5px; background-color: #c8e6c9;">
                        </div>
                        <div style="display: block; width: 900px; height: 50px; margin: 5px;">The Coverage bar shows how
                            many comments you know about including comments that are
                            similar to ones you interacted with.</div>
                    </div>
                    <div style=" display: flex; flex-direction: row; justify-content: flex-start;">
                        <div
                            style="display: block; width: 100px; height: 24px; margin: 5px; background-color: #ffcdd2;">
                        </div>
                        <div style="display: block; width: 900px; height: 50px; margin: 5px;">The
                            Distribution bar shows
                            how are you interacting with comments with different
                            sentiment
                            categories.</div>
                    </div>
                    <div style="display: flex; flex-direction: row;; justify-content: flex-start;">
                        <div style="display: flex; flex-direction: row; width: 100px; justify-content: center;"><img
                                src="dice.png" style="width: 40px; height:40px; margin:5px;"></div>
                        <div style="display: block; width: 900px; height: 50px; margin: 5px; padding: 10px;">Clicking
                            Dice button will
                            suggest you comments based your interactions with other
                            comments
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>
</div> -->

<div class="modal fade bd-example-modal-lg" id="aboutModal" tabindex="-1" role="dialog"
    aria-labelledby="aboutModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="aboutModalLabel">About</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <p>Dice is a research project aimed to study how users explore short free-form text information online
                    before making a decision. If you have any question about the project, contact:
                    <address>
                        <b>Mahmood Jasim</b><br>
                        Graduate Researcher<br>
                        College of Information and Computer Sciences<br>
                        University of Massachusetts<br>
                        Amherst, MA - 01002<br>
                        Email: <a href="mailto:mjasim@cs.umass.edu">mjasim@cs.umass.edu</a><br>
                    </address>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>

<div style="display:flex; flex-direction: column; align-items: center; overflow-y: auto;">
    <div id="header" style="margin: 5px">
        <div class="w3-content">
            <div class="row">
                <div class="col-12">
                    <select id="area" name="area">
                        <option value="">Pick a Product</option>
                        <option value="0">Koss Porta Pro On Ear Headphones with Case, Black / Silver</option>
                        <option value="1">Sony MDRV6 Studio Monitor Headphones with CCAW Voice Coil</option>
                        <option value="2">Sennheiser HD280PRO Headphones (old model)</option>
                        <option value="3">Sennheiser RS120 On-Ear Wireless RF Headphones with Charging Dock
                        </option>
                        <option value="4">Sony MDR7506 Professional Large Diaphragm Headphone</option>
                        <option value="5">Sennheiser HD 202 II Professional Headphones (Black)</option>
                        <option value="6">Sony MDREX10LP/BLK In-Ear Headphones</option>
                        <option value="7">Bose QuietComfort 15 Acoustic Noise Cancelling Headphones</option>
                        <option value="8">Bose QuietComfort 25 Acoustic Noise Cancelling Headphones</option>
                        <option value="9">Bluedio T2s Bluetooth Headphones On Ear with Mic, 57mm Driver
                        </option>
                    </select>
                </div>
            </div>
        </div>
    </div>

    <div id="topicbox"
        style="display:flex; flex-direction: row; flex-wrap: wrap; align-items: center; justify-content: center; margin:5px; width: 70%">
    </div>

    <div id="discbox"
        style="display:flex; flex-direction: row; flex-wrap: wrap; justify-content: center; align-items: center; margin:5px; width: 70%">
    </div>

    <div id="alltextbox"
        style="display:flex; flex-direction: row; flex-wrap: wrap; align-content: flex-start; justify-content: center; margin:5px; width:90%">
        <div id="textboxparent"
            style="display:flex; flex-direction: column; flex-wrap: wrap; justify-content: center; align-items: center; margin:5px; width:100%">
            <div id="textboxheader" style="width:90%; border:solid thin lightgray">
                <span id="commentheader">Comments: 0</span>
            </div>
            <div id="textbox" style="margin: 10px; max-width: 90%; height: 40vh; overflow-y:auto"></div>
        </div>
        <div id="serenboxparent"
            style="display:flex; flex-direction: column; flex-wrap: wrap; justify-content: center; align-content: center; margin:0px; width:0px; height:0px">
            <div id="serenboxheader" style="display:flex; flex-direction: row; width:0px">
                <div id="serenheader"></div>
                <div class="loader" id="serenloading" style="margin: 3px; margin-left: 5px; display: none;">
                </div>
            </div>
            <div id="serenbox" style="margin: 0px; max-width: 0px; height: 0px; overflow-y:auto;"></div>
        </div>
    </div>

    <div id="metricsbox"
        style="display:flex; flex-direction: row; flex-wrap: wrap; align-items: flex-start; margin:5px; width:90%">
        <div style="display:flex; flex-direction: column; align-items: center; width:31%; margin: 1%">
            <div class="metbar" id="visitback" style="border: solid thin lightgrey; width:100%">
                <div id="visitBar" style="height:24px; width:0%; background-color: #b3e5fc;">
                </div>
            </div>
            <div id="vistext">Visit: You looked at 0% comments</div>
        </div>

        <div style="display:flex; flex-direction: column; align-items: center; width:31%; margin: 1%">
            <div class="metbar" id="coverback" style="border: solid thin lightgrey; width:100%">
                <div id="coverageBar" style="height:24px; width:0%; background-color: #c8e6c9;">
                </div>
            </div>
            <div id="covtext">Coverage: You know about 0% comments</div>
        </div>

        <div style="display:flex; flex-direction: column; align-items: center; width:31%; margin: 1%">
            <div class="metbar" id="distback" style="border: solid thin lightgrey; width:100%">
                <div id="distributionBar" style="height:24px; width:0%; background-color: #ffcdd2;">
                </div>
            </div>
            <div id="disttext">Distribution: You looked at 0% sentiments</div>
        </div>
    </div>

    <div id="dice" title="Get suggested comments">
        <img src="dice.png" style="width: 40px; height:40px; margin:5px;">
    </div>

    <!-- <div id="cordbox" style="display:flex; flex-direction: row; align-items: center; margin:10px">
        <div id="coordinate" style="margin-right: 10px"></div>
        <div id="timing" style="margin-left: 10px"></div>
    </div> -->

    <!-- <div id="serenbox" style="margin: 10px; width: 960px; height: 150px; overflow-y:auto"></div> -->

</div>

<script src="https://d3js.org/d3.v4.min.js"></script>
<script src="interaction_log.js"></script>
<script type="text/javascript" src="hilitor.js"></script>
<script src="jquery.paginate.js"></script>

<script>
    time_start = 0
    orig_area_text = []
    time_end = 0
    full_data = null;
    text_filter = "null"
    topic_filter = ""
    disc_filter = ""
    did = null
    prev_did = null
    selected_id_ngram = ""
    prev_selected_id_ngram = ""
    dc_array = []
    explored_list = []
    unexplored_list = []
    covered_list = []
    comment_id_list = []
    dice_trigger = 0
    for (var i = 0; i < 30; i++) {
        explored_list[i] = []
        unexplored_list[i] = []
        dc_array[i] = []
        comment_id_list[i] = []
        covered_list[i] = []
    }

    selected_id_metric = ""
    prev_selected_id_metric = ""

    // discourses_array = {
    //     "question": 0,
    //     "answer": 0,
    //     "announcement": 0,
    //     "elaboration": 0,
    //     "appreciation": 0,
    //     "agreement": 0,
    //     "disagreement": 0,
    //     "negativereaction": 0,
    //     "humor": 0,
    //     "other": 0
    // }

    myHilitor = ""

    discourses_array = []
    metrics = []

    for (var i = 0; i < 30; i++) {
        discourses_array[i] = {
            "Positive": 0,
            "Negative": 0,
            "Neutral": 0,
        }

        metrics[i] = {
            "coverage": 0,
            "visit": 0,
            "distribution": 0,
        }
    }

    // d3.json("mat_data_cc.json", function (error, data) {
    //     if (error) throw error;
    //     full_data = JSON.parse(JSON.stringify(data));
    // })

    d3.json("mat_data_amz.json", function (error, data) {
        if (error) throw error;
        full_data = JSON.parse(JSON.stringify(data));
        console.log(full_data)

        orig_area_text = ["Koss Porta Pro On Ear Headphones with Case, Black / Silver",
            "Sony MDRV6 Studio Monitor Headphones with CCAW Voice Coil",
            "Sennheiser HD280PRO Headphones (old model)",
            "Sennheiser RS120 On-Ear Wireless RF Headphones with Charging Dock",
            "Sony MDR7506 Professional Large Diaphragm Headphone",
            "Sennheiser HD 202 II Professional Headphones (Black)",
            "Sony MDREX10LP/BLK In-Ear Headphones",
            "Bose QuietComfort 15 Acoustic Noise Cancelling Headphones",
            "Bose QuietComfort 25 Acoustic Noise Cancelling Headphones",
            "Bluedio T2s Bluetooth Headphones On Ear with Mic, 57mm Driver"
        ]
    })

    function render_topics(discussion_id) {
        proposal_data = full_data[discussion_id]
        // console.log(proposal_data)
        var myNode = document.getElementById("topicbox");
        while (myNode.firstChild) {
            myNode.removeChild(myNode.firstChild);
        }

        // for (var i in proposal_data.topics) {
        //     // console.log(proposal_data.topics[i].topic_phrase)
        //     var divbutton = document.createElement("div")
        //     var buttonHTML = '<button type="button" class="btn btn-warning topicbtn" style="margin:5px">' +
        //         proposal_data.topics[i].topic_phrase + '</button>'
        //     divbutton.innerHTML = buttonHTML;
        //     myNode.appendChild(divbutton)
        // }

        for (var i in proposal_data.ngrams) {
            // console.log(proposal_data.ngrams[i].ngram)
            var divbutton = document.createElement("div")
            var buttonHTML = '<div class="topicbtn" id="ngram_' + i +
                '\" style="margin:5px; background-color: white; padding-left:3px; padding-right:3px; border-radius: 5px; border: solid thin lightgray; text-align: center; width: 200px">' +
                proposal_data.ngrams[i].ngram + '</div>' +
                '<div style="margin:5px; padding-left:3px; padding-right:3px; position: relative; width: 200px; height: 24px">' +
                '<div class="tinybar" id=\"met_' +
                proposal_data.ngrams[i].ngram +
                '\" style="width: 0%; height: 100%; background-color:red; visibility:visible; border-radius: 5px; position: absolute; top:-29px; left: 0;"></div></div>';
            divbutton.innerHTML = buttonHTML;
            myNode.appendChild(divbutton)
        }
    }

    function reload_page() {
        logInteraction('click,nav_dice_brand,reload');
        window.location.reload()
        return false
    }

    function render_discourse(discussion_id) {
        proposal_data = full_data[discussion_id]
        // console.log(proposal_data.discourses)
        var myNode = document.getElementById("discbox");
        while (myNode.firstChild) {
            myNode.removeChild(myNode.firstChild);
        }

        for (var i in proposal_data.discourses) {

            var sent_color = "white"
            var sent_text = "black"


            // var sent_color = "lightgray"
            // var sent_text = "black"

            // // console.log("discbtn", proposal_data.discourses[i].discourse_name)

            // if (proposal_data.discourses[i].discourse_name == "Positive") {
            //     sent_color = "white"
            // } else if (proposal_data.discourses[i].discourse_name == "Negative") {
            //     sent_color = "black"
            //     sent_text = "white"
            // }

            // console.log(proposal_data.discourses[i].discourse_name) // this works
            var divbutton = document.createElement("div")
            var buttonHTML = '<div class= "discbtn" id="discourse_' +
                i +
                '\" style="margin:5px; padding-left:3px; padding-right:3px; border-radius: 5px; border: solid thin black; text-align: center; width: 200px; background-color: ' +
                sent_color + '; color: ' + sent_text +
                '\">' +
                proposal_data.discourses[i].discourse_name + '</div>' +
                '<div style="margin:5px; padding-left:3px; padding-right:3px; position: relative; width: 200px; height: 24px">' +
                '<div class="tinybar" id=\"met_' +
                proposal_data.discourses[i].discourse_name +
                '\" style="width: 0%; height: 100%; background-color:red; visibility:visible; border-radius: 5px; position: absolute; top:-29px; left: 0;"></div></div>';
            divbutton.innerHTML = buttonHTML;
            myNode.appendChild(divbutton)
        }
    }

    function render_text(text_filter) {
        // if (disc_filter) {
        //     text_filter = text_filter.substring(0, text_filter.indexOf(':'))
        // }

        var count = 0

        proposal_data = full_data[did]
        // console.log(proposal_data, disc_filter, topic_filter, text_filter)
        var myNode = document.getElementById("textbox");
        while (myNode.firstChild) {
            myNode.removeChild(myNode.firstChild);
        }

        for (var i in proposal_data.comments) {

            // var sent_color = "white"
            // var sent_text = "black"
            var sent = ""

            if (topic_filter && disc_filter) {
                var tokens = proposal_data.comments[i].comment.toLowerCase().split(" ");

                if ((tokens.includes(topic_filter.split(" ")[0]) || tokens.includes(topic_filter.split(" ")[
                        1])) &&
                    disc_filter == proposal_data.comments[i].discourse) {

                    count += 1

                    divSum = document.createElement("div")

                    // if (proposal_data.comments[i].discourse == "Positive") {
                    //     sent_color = "white"
                    // } else if (proposal_data.comments[i].discourse == "Negative") {
                    //     sent_color = "black"
                    //     sent_text = "white"
                    // }

                    if (proposal_data.comments[i].discourse == "Positive") {
                        sent = '<i class="fa fa-plus"></i>'
                    } else if (proposal_data.comments[i].discourse == "Negative") {
                        sent = '<i class="fa fa-minus"></i>'
                    } else {
                        sent = '<i class="fa fa-circle-o"></i>'
                    }

                    var divHTML =
                        '<div style=\"margin:3px; display:flex; flex-direction: row; align-items: flex-start\">' +
                        '<span ' +
                        ' style=\"padding-left:10px; padding-right:10px;' +
                        '\">' +
                        sent + '</span>' + "\xa0\xa0\xa0" +
                        '<p class="commentText" id="comment_' + proposal_data.comments[i].comment_id + '">' +
                        proposal_data.comments[i].comment + '</p> </div>'
                    divSum.innerHTML = divHTML;
                    myNode.appendChild(divSum)

                    if (comment_id_list[did].includes(proposal_data.comments[i].comment_id)) {
                        console.log("here")
                        document.getElementById("comment_" + proposal_data.comments[i].comment_id).setAttribute(
                            "style",
                            "background-color: #b3e5fc")
                    }
                }


            } else if (topic_filter && !disc_filter) {
                // if (text_filter == proposal_data.comments[i].topic_phrase) {
                //     divSum = document.createElement("div")

                //     var divHTML =
                //         '<div style=\"margin:3px; display:flex; flex-direction: row; align-items: flex-start\">' +
                //         '<span ' +
                //         'style=\"background-color:lightgray; padding-left:10px; padding-right:10px; border-radius:10px;\">' +
                //         proposal_data.comments[i].discourse + '</span>' + "\xa0\xa0\xa0" +
                //         '<div class="commentText" id="comment_' + i + '">' + proposal_data.comments[i].comment +
                //         '</div></div>'
                //     divSum.innerHTML = divHTML;
                //     myNode.appendChild(divSum)
                // }

                var tokens = proposal_data.comments[i].comment.toLowerCase().split(" ");

                if ((tokens.includes(topic_filter.split(" ")[0]) || tokens.includes(topic_filter.split(" ")[
                        1]))) {
                    // || (proposal_data.comments[i].lemmas.includes(text_filter.split(" ")[0]) || proposal_data.comments[i].lemmas.includes(text_filter.split(" ")[1]))) 

                    count += 1

                    divSum = document.createElement("div")

                    // if (proposal_data.comments[i].discourse == "Positive") {
                    //     sent_color = "white"
                    // } else if (proposal_data.comments[i].discourse == "Negative") {
                    //     sent_color = "black"
                    //     sent_text = "white"
                    // }

                    if (proposal_data.comments[i].discourse == "Positive") {
                        sent = '<i class="fa fa-plus"></i>'
                    } else if (proposal_data.comments[i].discourse == "Negative") {
                        sent = '<i class="fa fa-minus"></i>'
                    } else {
                        sent = '<i class="fa fa-circle-o"></i>'
                    }

                    var divHTML =
                        '<div style=\"margin:3px; display:flex; flex-direction: row; align-items: flex-start\">' +
                        '<span ' +
                        ' style=\"padding-left:10px; padding-right:10px; ' +
                        '\">' +
                        sent + '</span>' + "\xa0\xa0\xa0" +
                        '<p class="commentText" id="comment_' + proposal_data.comments[i].comment_id + '">' +
                        proposal_data.comments[i].comment + '</p> </div>'
                    divSum.innerHTML = divHTML;
                    myNode.appendChild(divSum)

                    if (comment_id_list[did].includes(proposal_data.comments[i].comment_id)) {
                        console.log("here")
                        document.getElementById("comment_" + proposal_data.comments[i].comment_id).setAttribute(
                            "style",
                            "background-color: #b3e5fc")
                    }
                }

                // if (text_filter == proposal_data.ngrams[i].ngram) {
                //     divSum = document.createElement("div")

                //     var divHTML =
                //         '<div style=\"margin:3px; display:flex; flex-direction: row; align-items: flex-start\">' +
                //         '<span ' +
                //         ' style=\"background-color:lightgray; padding-left:10px; padding-right:10px; border - radius: 10 px;\">' +
                //         proposal_data.comments[i].discourse + '</span>' + "\xa0\xa0\xa0" +
                //         '<div class="commentText" id="comment_' + proposal_data.comments[i].comment_id + '">' + proposal_data.comments[i].comment +
                //         '</div></div>'
                //     divSum.innerHTML = divHTML;
                //     myNode.appendChild(divSum)
                // }
            } else if (disc_filter && !topic_filter) {
                if (disc_filter == proposal_data.comments[i].discourse) {

                    count += 1

                    // if (proposal_data.comments[i].discourse == "Positive") {
                    //     sent_color = "white"
                    // } else if (proposal_data.comments[i].discourse == "Negative") {
                    //     sent_color = "black"
                    //     sent_text = "white"
                    // }

                    if (proposal_data.comments[i].discourse == "Positive") {
                        sent = '<i class="fa fa-plus"></i>'
                    } else if (proposal_data.comments[i].discourse == "Negative") {
                        sent = '<i class="fa fa-minus"></i>'
                    } else {
                        sent = '<i class="fa fa-circle-o"></i>'
                    }

                    divSum = document.createElement("div")
                    // var divHTML =
                    //     '<div class="commentText" style=\"margin:3px; display:flex; flex-direction: row; align-items: flex-start\">' +
                    //     proposal_data.comments[i].comment + '</div>'

                    var divHTML =
                        '<div style=\"margin:3px; display:flex; flex-direction: row; align-items: flex-start\">' +
                        '<span ' +
                        ' style=\"padding-left:10px; padding-right:10px;' +
                        '\">' +
                        sent + '</span>' + "\xa0\xa0\xa0" +
                        '<p class="commentText" id="comment_' + proposal_data.comments[i].comment_id + '">' +
                        proposal_data.comments[i].comment + '</p> </div>'
                    divSum.innerHTML = divHTML;
                    myNode.appendChild(divSum)

                    if (comment_id_list[did].includes(proposal_data.comments[i].comment_id)) {
                        console.log("here")
                        document.getElementById("comment_" + proposal_data.comments[i].comment_id).setAttribute(
                            "style",
                            "background-color: #b3e5fc")
                    }
                }
            } else if (!text_filter) {

                count += 1

                // if (proposal_data.comments[i].discourse == "Positive") {
                //     sent_color = "white"
                // } else if (proposal_data.comments[i].discourse == "Negative") {
                //     sent_color = "black"
                //     sent_text = "white"
                // }

                if (proposal_data.comments[i].discourse == "Positive") {
                    sent = '<i class="fa fa-plus"></i>'
                } else if (proposal_data.comments[i].discourse == "Negative") {
                    sent = '<i class="fa fa-minus"></i>'
                } else {
                    sent = '<i class="fa fa-circle-o"></i>'
                }

                divSum = document.createElement("div")
                var divHTML =
                    '<div style=\"margin:3px; display:flex; flex-direction: row; align-items: flex-start\">' +
                    '<span ' +
                    ' style=\"padding-left:10px; padding-right:10px;' +
                    '\">' +
                    sent + '</span>' + "\xa0\xa0\xa0" +
                    '<p class="commentText" id="comment_' + proposal_data.comments[i].comment_id + '">' +
                    proposal_data.comments[i].comment + '</p> </div>'
                divSum.innerHTML = divHTML;
                myNode.appendChild(divSum)

                if (comment_id_list[did].includes(proposal_data.comments[i].comment_id)) {
                    console.log("here")
                    document.getElementById("comment_" + proposal_data.comments[i].comment_id).setAttribute(
                        "style",
                        "background-color: #b3e5fc")
                }
            }
        }

        // console.log(count)

        document.getElementById("textboxheader").textContent = "Comments: " + count
        do_pagination()
    }

    function render_serenbox(data) {
        var myNode = document.getElementById("serenbox");
        while (myNode.firstChild) {
            myNode.removeChild(myNode.firstChild);
        }

        console.log(data)

        divSum = document.createElement("div")
        var divHTML = '<div class="serenText" id="seren_comment_' + data[1][0].id +
            '" style=" margin-bottom: 10px">' + '&#8226; ' +
            data[1][0]
            .text +
            '</div>' +
            '<div class="serenText" id="seren_comment_' + data[1][1].id + '" style="margin-bottom: 10px">' +
            '&#8226; ' +
            data[1][1].text +
            '</div>' +
            '<div class="serenText" id="seren_comment_' + data[1][2].id + '" style="margin-bottom: 10px">' +
            '&#8226; ' +
            data[1][2].text +
            '</div>' +
            '<div class="serenText" id="seren_comment_' + data[1][3].id + '" style="margin-bottom: 10px">' +
            '&#8226; ' +
            data[1][3].text +
            '</div>' +
            '<div class="serenText" id="seren_comment_' + data[1][4].id + '" style="margin-bottom: 10px">' +
            '&#8226; ' +
            data[1][4].text +
            '</div>';

        divSum.innerHTML = divHTML;
        myNode.appendChild(divSum)
    }

    function tinymove(bar_id, max_len) {
        var elem = document.getElementById(bar_id);
        var width = 0
        var id = setInterval(frame, 10);

        function frame() {
            if (width >= max_len) {
                clearInterval(id);
            } else {
                width = width + 1;
                elem.style.width = width + '%';
            }
        }
    }

    function move(bar_id, max_len) {
        var elem = document.getElementById(bar_id);
        var width = 0

        if (bar_id == "coverageBar") {
            width = metrics[did].coverage
        } else if (bar_id == "distributionBar") {
            width = metrics[did].distribution
        } else {
            width = metrics[did].visit
        }

        // console.log(width, max_len)
        var id = setInterval(frame, 10);

        function frame() {
            if (width >= max_len) {
                clearInterval(id);
            } else {
                width = width + 1;
                elem.style.width = width + '%';
                elem.innerHTML = '<b>' + ' ' + width * 1 + '%'
                '</b>';
            }

            if (bar_id == "coverageBar") {
                metrics[did].coverage = width
                document.getElementById("covtext").innerHTML = 'Coverage: You know about ' + width * 1 +
                    '% comments';
            } else if (bar_id == "distributionBar") {
                metrics[did].distribution = width

                var proposal_data = full_data[did]
                var explored_ids = []
                for (var i in explored_list[did]) {
                    explored_ids.push(explored_list[did][i].id)
                }
                var pos = 0
                var neg = 0
                var neut = 0

                for (var i in proposal_data.comments) {
                    if (explored_ids.includes(proposal_data.comments[i].comment_id.toString())) {
                        if (proposal_data.comments[i].discourse == "Positive") {
                            pos += 1
                        } else if (proposal_data.comments[i].discourse == "Negative") {
                            neg += 1
                        } else {
                            neut += 1
                        }
                    }
                }
                var total = pos + neg + neut
                var items = [{
                    "sent": "Positive",
                    "count": pos
                }, {
                    "sent": "Negative",
                    "count": neg
                }, {
                    "sent": "Neutral",
                    "count": neut
                }]
                var total = pos + neg + neut
                var sorted = items.sort(function (a, b) {
                    return b.count - a.count
                })

                var fgroup = ((sorted[0].count / total) - (sorted[1].count / total)) * 100

                if (fgroup > 10) {
                    document.getElementById("disttext").innerHTML = 'Distribution: You mostly looked at ' +
                        sorted[
                            0]
                        .sent + ' comments';
                } else {
                    var sgroup = ((sorted[1].count / total) - (sorted[2].count / total)) * 100
                    if (sgroup > 10) {
                        document.getElementById("disttext").innerHTML = 'Distribution: You mostly looked at ' +
                            sorted[0]
                            .sent + ' and ' + sorted[1]
                            .sent + ' comments';
                    } else {
                        document.getElementById("disttext").innerHTML =
                            'Distribution: You looked at all kinds of comments';
                    }
                }

                // document.getElementById("disttext").innerHTML = 'Distribution: ' + width * 1 + '%';
            } else {
                metrics[did].visit = width
                document.getElementById("vistext").innerHTML = 'Visit: You looked at ' + width * 1 +
                    '% comments';
            }
        }
    }

    function refresh_move(bar_id) {
        var elem = document.getElementById(bar_id);
        // elem.style.width = '0%';
        // elem.innerHTML = "";

        // console.log(metrics)

        if (bar_id == "coverageBar") {
            width = metrics[did].coverage
            document.getElementById("covtext").innerHTML = 'Coverage: You know about ' + width * 1 +
                '% comments';
        } else if (bar_id == "distributionBar") {
            width = metrics[did].distribution
            document.getElementById("disttext").innerHTML = 'Distribution: You looked at ' + width * 1 +
                '% sentiments';
        } else {
            width = metrics[did].visit
            document.getElementById("vistext").innerHTML = 'Visit: You looked at ' + width * 1 +
                '% comments';
        }

        elem.style.width = width + '%';
        elem.innerHTML = '<b>' + ' ' + width * 1 + '%'
        '</b>';
    }

    function get_visit() {
        var cnt = 0
        for (var i in dc_array[did]) {
            if (dc_array[did][i] == 1) {
                cnt = cnt + 1
            }
        }
        // console.log((cnt / dc_array[did].length) * 100)
        move("visitBar", (cnt / dc_array[did].length) * 100);
    }

    function get_distribution() {
        var active_cnt = 0
        var perc_per_discourse = 0
        var cnt = 0
        proposal_disc = full_data[did].discourses
        // console.log(proposal_disc)
        for (var i in proposal_disc) {
            if (proposal_disc[i].count > 0) {
                active_cnt += 1
            }
        }
        active_cnt = 100 / active_cnt

        // console.log(active_cnt)

        for (var i in proposal_disc) {
            if (proposal_disc[i].count > 0) {
                perc_per_discourse += (discourses_array[did][proposal_disc[i].discourse_name] / proposal_disc[i]
                        .count) *
                    active_cnt

                // console.log(perc_per_discourse)
            }
        }
        move("distributionBar", perc_per_discourse);
    }

    function get_coverage(disc_comments) {

        // for (var i in disc_comments) {
        //     for (var j in explored_list) {
        //         if (disc_comments[i].comment != explored_list[j])
        //             unexplored_list.push(disc_comments[i].comment)
        //     }
        // }

        console.log(explored_list[did], unexplored_list[did])

        $.ajax({
            type: "POST",
            url: "http://mjasim.pythonanywhere.com/",
            data: JSON.stringify({
                explored: explored_list[did],
                unexplored: unexplored_list[did]
            }),
            contentType: 'application/json;charset=UTF-8',
            success: function (data, status) {
                // console.log(data, status);

                var covered_ids = []

                for (var i in covered_list[did]) {
                    covered_ids.push(covered_list[did][i].id)
                }

                // console.log(covered_ids)

                render_serenbox(data);

                for (var i in data[0]) {
                    // console.log(data[0][i].id, covered_ids)
                    if (!covered_ids.includes(data[0][i].id.toString())) {
                        covered_list[did].push({
                            "id": data[0][i].id.toString(),
                            "text": data[0][i].text
                        })
                    }
                }

                // console.log(explored_list[did], covered_list[did], data[0])

                move("coverageBar", ((covered_list[did].length) / disc_comments
                        .length) *
                    100);
            }
        });
    }

    $(document).ready(function () {
        $('#area').on('change', function () {
            var discussion_id = $("#area").val();

            // console.log(localStorage.userID_dice)

            if (prev_did) {
                var area_text = $('#area option[value=' + prev_did + ']').text()
                console.log(area_text)
                $('#area option[value=' + prev_did + ']').html(orig_area_text[prev_did] +
                    ' - Visit: ' +
                    '<div style="color: blue">' + metrics[prev_did].visit + '</div>' +
                    '% Coverage: ' + '<div style="color: green">' + metrics[prev_did]
                    .coverage + '</div>' + '% Distribution: ' +
                    '<div style="color: red">' + metrics[prev_did].distribution +
                    '%' + '</div>')
            }

            render_topics(discussion_id)
            render_discourse(discussion_id)

            var myNode = document.getElementById("textbox");
            while (myNode.firstChild) {
                myNode.removeChild(myNode.firstChild);
            }

            did = discussion_id

            logInteraction('click,product_' + did + ',select product from dropdown')

            selected_id_ngram = ""
            prev_selected_id_ngram = ""

            selected_id_disc = ""
            prev_selected_id_disc = ""

            // metrics.coverage = 0
            // metrics.visit = 0
            // metrics.distribution = 0
            // metrics.depth = 0

            // discourses_array.question = 0
            // discourses_array.answer = 0
            // discourses_array.announcement = 0
            // discourses_array.elaboration = 0
            // discourses_array.appreciation = 0
            // discourses_array.agreement = 0
            // discourses_array.disagreement = 0
            // discourses_array.negativereaction = 0
            // discourses_array.humor = 0
            // discourses_array.other = 0

            // discourses_array.positive = 0
            // discourses_array.negative = 0
            // discourses_array.neutral = 0

            topic_filter = ""
            disc_filter = ""
            text_filter = ""

            // explored_list = []

            for (var i in full_data[did].comments) {
                unexplored_list[did].push({
                    "id": full_data[did].comments[i].comment_id,
                    "text": full_data[did].comments[i].comment
                })
            }

            if (dc_array[did].length < 1) {
                dc_array[did] = new Array(full_data[did].comments.length)
            }

            // console.log("dc_array", dc_array[did])

            refresh_move("coverageBar")
            refresh_move("distributionBar")
            refresh_move("visitBar")

            render_text(text_filter)

            if (dice_trigger == 1) {
                dice_trigger = 0

                document.getElementById("serenboxparent").setAttribute("style",
                    "margin: 0px; width: 0px; height: 0px;")

                document.getElementById("serenbox").setAttribute("style",
                    "margin: 0px; width: 0px; height: 0px; overflow-y:auto")

                document.getElementById("serenboxheader").setAttribute("style",
                    "display:flex; flex-direction: row; width: 0px;"
                )

                document.getElementById("serenheader").textContent = ''

                document.getElementById("textboxparent").setAttribute("style",
                    "display:flex; flex-direction: column; flex-wrap: wrap; justify-content: center; align-items: center; margin:5px;"
                )
                document.getElementById("textbox").setAttribute("style",
                    "margin: 5px; max-width: 90%; height: 40vh; overflow-y:auto"
                )
            }

            prev_did = did
        });
    });

    $(document).on('click', '.topicbtn', function () {
        console.log($(this)[0].innerText)
        topic_filter = $(this)[0].innerText

        selected_id_ngram = $(this)[0].id
        // if (selected_id_disc) {
        //     document.getElementById(selected_id_disc).setAttribute("style", "border: solid thick white")
        //     selected_id_disc = ""
        //     prev_selected_id_disc = ""
        // }

        console.log(selected_id_ngram, prev_selected_id_ngram, selected_id_disc, prev_selected_id_disc)

        if (prev_selected_id_ngram == selected_id_ngram) {
            logInteraction('click,ngram_' + topic_filter + ',deselect an ngram')
            document.getElementById(selected_id_ngram).setAttribute("style",
                "margin:5px; padding-left:3px; padding-right:3px; border-radius: 5px; border: solid thin lightgray; text-align: center; width: 200px;"
            )
            selected_id_ngram = ""
            prev_selected_id_ngram = ""
            topic_filter = ""
            if (selected_id_disc) {
                console.log("discsdics - ", $("#" + selected_id_disc)[0].innerText)
                render_text($("#" + selected_id_disc)[0].innerText)
            } else {
                render_text("")
            }
        } else {
            logInteraction('click,ngram_' + topic_filter + ',select an ngram')
            document.getElementById(selected_id_ngram).setAttribute("style",
                "margin:5px; padding-left:3px; padding-right:3px; border-radius: 5px; border: solid 2px goldenrod; text-align: center; width: 200px;"
            )
            if (prev_selected_id_ngram) {
                document.getElementById(prev_selected_id_ngram).setAttribute("style",
                    "margin:5px; padding-left:3px; padding-right:3px; border-radius: 5px; border: solid thin lightgray; text-align: center; width: 200px;"
                )
            }
            prev_selected_id_ngram = selected_id_ngram
            console.log($(this)[0].innerText)
            render_text($(this)[0].innerText)

            myHilitor = new Hilitor("textbox");
            myHilitor.apply(topic_filter);
        }
    });

    $(document).on('click', '.discbtn', function () {
        console.log($(this)[0].innerText)
        disc_filter = $(this)[0].innerText
        console.log("click", disc_filter)

        var sent_color = "white"
        var sent_text = "black"

        // var sent_color = "lightgray"
        // var sent_text = "black"
        // if (disc_filter == "Positive") {
        //     sent_color = "white"
        // } else if (disc_filter == "Negative") {
        //     sent_color = "black"
        //     sent_text = "white"
        // }


        selected_id_disc = $(this)[0].id
        // if (selected_id_ngram) {
        //     document.getElementById(selected_id_ngram).setAttribute("style", "border: solid thick white")
        //     selected_id_ngram = ""
        //     prev_selected_id_ngram = ""
        // }

        console.log(selected_id_disc, prev_selected_id_disc)

        if (prev_selected_id_disc == selected_id_disc) {
            logInteraction('click,sentiment_' + disc_filter + ',deselect a sentiment')
            var styletext =
                'margin:5px; padding-left:3px; padding-right:3px; border-radius: 5px; border: solid thin lightgray; text-align: center; width: 200px; background-color: ' +
                sent_color + '; color: ' + sent_text;
            document.getElementById(selected_id_disc).setAttribute("style", styletext)
            selected_id_disc = ""
            prev_selected_id_disc = ""

            disc_filter = ""
            if (selected_id_ngram) {
                render_text($("#" + selected_id_ngram)[0].innerText)
            } else {
                render_text("")
            }

            if (topic_filter) {
                myHilitor = new Hilitor("textbox");
                myHilitor.apply(topic_filter);
            }

        } else {
            logInteraction('click,sentiment_' + disc_filter + ',select a sentiment')
            var styletext =
                'margin:5px; padding-left:3px; padding-right:3px; border-radius: 5px; border: solid 2px goldenrod; text-align: center; width: 200px; background-color: ' +
                sent_color + '; color: ' + sent_text;
            document.getElementById(selected_id_disc).setAttribute("style", styletext)

            if (prev_selected_id_disc) {

                // var sent_color = "lightgray"
                // var sent_text = "black"
                // if (prev_selected_id_disc == "discourse_0") {
                //     sent_color = "white"
                // } else if (prev_selected_id_disc == "discourse_2") {
                //     sent_color = "black"
                //     sent_text = "white"
                // }

                var styletext =
                    'margin:5px; padding-left:3px; padding-right:3px; border-radius: 5px; border: solid thin lightgray; text-align: center; width: 200px; background-color: ' +
                    sent_color + '; color: ' + sent_text;
                document.getElementById(prev_selected_id_disc).setAttribute("style", styletext)
            }

            prev_selected_id_disc = selected_id_disc
            render_text($(this)[0].innerText)
            console.log($(this)[0].innerText)

            if (topic_filter) {
                myHilitor = new Hilitor("textbox");
                myHilitor.apply(topic_filter);
            }
        }
    });

    function comment_interact(id) {
        var text = ""
        // console.log("inside comment intr --", id)

        var covered_ids = []
        for (var i in covered_list[did]) {
            covered_ids.push(covered_list[did][i].id)
        }

        // if (!covered_ids.includes(data[0][i].id.toString())) {
        //     covered_list[did].push({
        //         "id": data[0][i].id.toString(),
        //         "text": data[0][i].text
        //     })
        // }

        for (var i in full_data[did].comments) {
            if (full_data[did].comments[i].comment_id.toString() == id) {
                text = full_data[did].comments[i].comment
                // console.log(text)
                if (!dc_array[did][i]) {
                    dc_array[did][i] = 1
                    discourses_array[did][full_data[did].comments[i].discourse] += 1
                    comment_id_list[did].push(full_data[did].comments[i].comment_id)

                    explored_list[did].push({
                        "id": id,
                        "text": text
                    })

                    if (!covered_ids.includes(id)) {
                        covered_list[did].push({
                            "id": id,
                            "text": text
                        })
                    }
                }
                // comment_id_list[did].push(full_data[did].comments[i].comment_id)
                if (document.getElementById("comment_" + full_data[did].comments[i].comment_id)) {
                    document.getElementById("comment_" + full_data[did].comments[i].comment_id).setAttribute(
                        "style",
                        "background-color: #b3e5fc")
                }
            }
        }

        // // explored_list[did].push(text)
        // explored_list[did].push({
        //     "id": id,
        //     "text": text
        // })

        // covered_list[did].push({
        //     "id": id,
        //     "text": text
        // })

        for (var i in unexplored_list[did]) {
            if (unexplored_list[did][i].text == text) {
                unexplored_list[did].splice(i, 1)
            }
        }

        get_distribution()
        get_coverage(full_data[did].comments)
        get_visit()
    }

    function isScrolledIntoView(elem) {
        var docViewTop = $('#textbox').scrollTop();
        var docViewBottom = docViewTop + $('#textbox').height();

        var elemTop = $(elem).offset().top;
        var elemBottom = elemTop + $(elem).height();

        return ((elemBottom <= docViewBottom) && (elemTop >= docViewTop));
    }

    function do_pagination() {

        if (document.getElementById("paginatepage")) {
            var myNode = document.getElementById("paginatepage");
            while (myNode.firstChild) {
                myNode.removeChild(myNode.firstChild);
            }

            $('#textbox').unbind().removeData();
        }

        $('#textbox').paginate({
            scope: $('div'), // targets all div elements
            autoScroll: true,
            perPage: 100
        })

        $('#textbox').animate({
            scrollTop: "0"
        }, 1000)
    }

    $(document).on('click', '.commentText', function () {

        // console.log(dice_trigger)
        if (dice_trigger == 1) {
            document.getElementById("serenloading").style.display = "block"
            setTimeout(function () {
                document.getElementById("serenloading").style.display = "none"
            }, 3000)
        }
        logInteraction('click,comment_' + $(this)[0].id.substring(8) + ',interact with a comment')
        comment_interact($(this)[0].id.substring(8))
        // document.getElementById("timing").innerText = " clicked - " + $(this)[0].innerText
    });

    $(document).on('click', '.serenText', function () {

        id = $(this)[0].id
        document.getElementById(id).setAttribute(
            "style",
            "background-color: #b3e5fc")

        if (dice_trigger == 1) {
            document.getElementById("serenloading").style.display = "block"
            setTimeout(function () {
                document.getElementById("serenloading").style.display = "none"
            }, 3000)
        }

        logInteraction('click,serencomment_' + $(this)[0].id.substring(14) +
            ',interact with a suggested comment')
        comment_interact($(this)[0].id.substring(14))
    });

    $(document).on('mouseover', '.commentText', function () {
        time_start = Date.now();
        // console.log($(this)[0].innerText, start)
    });

    $(document).on('mouseover', '.serenText', function () {
        time_start = Date.now();
        // console.log($(this)[0].innerText, start)
    });

    $(document).on('mouseout', '.commentText', function () {
        time_end = Date.now();
        var elapsed_time = ((time_end - time_start) / 1000)
        // console.log(elapsed_time, $(this)[0].innerText)
        if (this.className == 'commentText' && elapsed_time > 2) {
            if (dice_trigger == 1) {
                document.getElementById("serenloading").style.display = "block"
                setTimeout(function () {
                    document.getElementById("serenloading").style.display = "none"
                }, 3000)
            }

            logInteraction('hover,comment_' + $(this)[0].id.substring(8) + ',interact with a comment')
            comment_interact($(this)[0].id.substring(8))
        }
        // document.getElementById("timing").innerText = "hovered " + elapsed_time + " s over " + $(this)[
        //         0]
        //     .innerText
    });

    $(document).on('mouseout', '.serenText', function () {
        time_end = Date.now();

        var elapsed_time = ((time_end - time_start) / 1000)
        // console.log(elapsed_time, $(this)[0].innerText)
        if (this.className == 'serenText' && elapsed_time > 2) {

            id = $(this)[0].id
            document.getElementById(id).setAttribute(
                "style",
                "background-color: #b3e5fc")

            if (dice_trigger == 1) {
                document.getElementById("serenloading").style.display = "block"
                setTimeout(function () {
                    document.getElementById("serenloading").style.display = "none"
                }, 4000)
            }

            logInteraction('hover,comment_' + $(this)[0].id.substring(8) + ',interact with a suggested comment')
            comment_interact($(this)[0].id.substring(14))
        }
        // document.getElementById("timing").innerText = "hovered " + elapsed_time + " s over " + $(this)[
        // 0]
        // .innerText
    });

    // $(document).on('mousemove', function () {
    //     document.getElementById("coordinate").innerText = event.pageX + ", " + event.pageY
    // });

    $(document).on('click', "#dice", function () {

        if (dice_trigger == 0 && document.getElementById("serenbox").hasChildNodes()) {
            logInteraction('click,dice,get suggested comments')
            dice_trigger = 1
            document.getElementById("serenboxparent").setAttribute("style",
                "display:flex; flex-direction: row; flex-wrap: wrap; justify-content: center; align-items: center; align-content: flex-start; margin: 5px; max-width: 45%; height: 55vh;"
            )

            document.getElementById("serenbox").setAttribute("style",
                "margin: 10px; max-width: 90%; height: 40vh; overflow-y:auto;")

            document.getElementById("textboxparent").setAttribute("style",
                "display:flex; flex-direction: row; flex-wrap: wrap; align-items: center; justify-content: center; margin: 5px; max-width: 45%; height: 55vh;"
            )

            document.getElementById("serenboxheader").setAttribute("style",
                "display:flex; flex-direction: row; width: 90%; border: solid thin lightgray"
            )

            document.getElementById("serenheader").textContent = 'Suggested Comments'

            do_pagination()

        } else if (dice_trigger == 1 && document.getElementById("serenbox").hasChildNodes()) {
            logInteraction('click,dice,remove suggested comments')
            dice_trigger = 0

            document.getElementById("serenboxparent").setAttribute("style",
                "margin: 0px; width: 0px; height: 0px;")

            document.getElementById("serenbox").setAttribute("style",
                "margin: 0px; width: 0px; height: 0px; overflow-y:auto")

            document.getElementById("serenboxheader").setAttribute("style",
                "display:flex; flex-direction: row; width: 0px;"
            )

            document.getElementById("serenheader").textContent = ''

            document.getElementById("textboxparent").setAttribute("style",
                "display:flex; flex-direction: column; flex-wrap: wrap; justify-content: center; align-items: center; margin:5px;"
            )
            document.getElementById("textbox").setAttribute("style",
                "margin: 5px; max-width: 90%; height: 40vh; overflow-y:auto"
            )
        }

        // <div id="alltextbox" style="display:flex; flex-direction: row; flex-wrap: wrap; align-items: center; margin:5px">
        //     <div id="textboxparent"
        //         style="display:flex; flex-direction: column; flex-wrap: wrap; align-items: center; margin:5px">
        //         <div id="textbox" style="margin: 10px; max-width: 90%; height: 40vh; overflow-y:auto"></div>
        //     </div>
        //     <div id="serenbox" style="margin: 0px; max-width: 0px; height: 0px; overflow-y:auto;"></div>
        // </div>
    });

    $('#textbox').on('scroll', function () {
        var x = document.getElementById("textbox").childNodes

        var ids = $('#textbox .commentText').map(function () {
            return $(this).attr('id');
        }).get();
        for (var i in ids) {
            if ((isScrolledIntoView("#" + ids[i]))) {
                // console.log(ids[i])
            }
        }
    });


    function calc_tiny_visit(category, tag, totalcount) {
        var proposal_data = full_data[did]
        var explored_ids = []
        var met_count = 0

        // console.log(category, tag, totalcount)

        for (var i in explored_list[did]) {
            explored_ids.push(explored_list[did][i].id)
        }

        if (category == "ngram") {
            for (var i in proposal_data.comments) {
                if (explored_ids.includes(proposal_data.comments[i].comment_id.toString())) {
                    var tokens = proposal_data.comments[i].comment.toLowerCase().split(" ");
                    if ((tokens.includes(tag.split(" ")[0]) || tokens.includes(tag.split(" ")[1]))) {
                        met_count += 1
                    }
                }
            }
            // console.log(met_count)
        } else if (category == "discourse") {
            for (var i in proposal_data.comments) {
                if (explored_ids.includes(proposal_data.comments[i].comment_id.toString()) && proposal_data
                    .comments[i]
                    .discourse ==
                    tag) {
                    met_count += 1
                }
            }
        }

        // console.log(tag, met_count, totalcount)
        return ((met_count / totalcount) * 100)
    }

    function calc_tiny_cover(category, tag, totalcount) {
        var proposal_data = full_data[did]
        var covered_ids = []
        var met_count = 0

        // console.log(category, tag, totalcount)

        for (var i in covered_list[did]) {
            covered_ids.push(covered_list[did][i].id)
        }

        if (category == "ngram") {
            for (var i in proposal_data.comments) {
                if (covered_ids.includes(proposal_data.comments[i].comment_id.toString())) {
                    var tokens = proposal_data.comments[i].comment.toLowerCase().split(" ");
                    if ((tokens.includes(tag.split(" ")[0]) || tokens.includes(tag.split(" ")[1]))) {
                        met_count += 1
                    }
                }
            }
            // console.log(met_count)
        } else if (category == "discourse") {
            for (var i in proposal_data.comments) {
                if (covered_ids.includes(proposal_data.comments[i].comment_id.toString()) && proposal_data
                    .comments[i]
                    .discourse == tag) {
                    met_count += 1
                }
            }
        }

        // console.log(tag, met_count, totalcount)
        return ((met_count / totalcount) * 100)
    }

    function calc_tiny_dist(category, tag, totalcount) {
        var proposal_data = full_data[did]
        var explored_ids = []
        var pos = 0
        var neg = 0
        var neut = 0
        var tot_pos = 0
        var tot_neg = 0
        var tot_neut = 0
        var met_count = 0
        var met_return = 0

        var active_cnt = 0
        var perc_per_discourse = 0
        var cnt = 0
        proposal_disc = full_data[did].discourses
        for (var i in proposal_disc) {
            if (proposal_disc[i].count > 0) {
                active_cnt += 1
            }
        }
        active_cnt = 100 / active_cnt

        for (var i in proposal_data.comments) {
            var tot_tokens = proposal_data.comments[i].comment.toLowerCase().split(" ");
            if ((tot_tokens.includes(tag.split(" ")[0]) || tot_tokens.includes(tag.split(" ")[1]))) {
                // console.log("here")
                if (proposal_data.comments[i].discourse == "Positive") {
                    tot_pos += 1
                } else if (proposal_data.comments[i].discourse == "Negative") {
                    tot_neg += 1
                } else {
                    tot_neut += 1
                }
            }
        }

        // console.log(tag, tot_pos, tot_neg, tot_neut)

        for (var i in explored_list[did]) {
            explored_ids.push(explored_list[did][i].id)
        }

        if (category == "ngram") {
            for (var i in proposal_data.comments) {
                if (explored_ids.includes(proposal_data.comments[i].comment_id.toString())) {
                    // console.log("found explored")
                    var tokens = proposal_data.comments[i].comment.toLowerCase().split(" ");
                    if ((tokens.includes(tag.split(" ")[0]) || tokens.includes(tag.split(" ")[1]))) {
                        if (proposal_data.comments[i].discourse == "Positive") {
                            pos += 1
                        } else if (proposal_data.comments[i].discourse == "Negative") {
                            neg += 1
                        } else {
                            neut += 1
                        }
                    }
                }
            }

            met_return = ((pos / tot_pos) + (neg / tot_neg) + (neut / tot_neut)) * active_cnt

        } else if (category == "discourse") {
            for (var i in proposal_data.comments) {
                if (explored_ids.includes(proposal_data.comments[i].comment_id.toString()) && proposal_data
                    .comments[i]
                    .discourse ==
                    tag) {
                    met_count += 1
                }
            }
            met_return = ((met_count / totalcount) * 100)
        }
        console.log(met_return)
        return met_return
    }

    function gototutorial() {
        window.open('tutorial.html', "_blank")
    }

    $(document).on('mouseover', '.metbar', function () {

        if (did) {
            var x_array = document.getElementsByClassName("tinybar")

            var tinycolor = ""
            var id = $(this)[0].id
            selected_id_metric = id

            logInteraction('hover,bar_' + id + ',hovered on metric bar')

            document.getElementById(selected_id_metric).setAttribute("style",
                "border: solid 2px goldenrod; width:100%")

            proposal_data = full_data[did]

            var ngram_list = []

            for (var i in proposal_data.ngrams) {
                ngram_list.push(proposal_data.ngrams[i].ngram)
            }

            for (var i in ngram_list) {
                var totalcount = 0
                for (var j in proposal_data.comments) {
                    var tokens = proposal_data.comments[j].comment.toLowerCase().split(" ");

                    if ((tokens.includes(ngram_list[i].split(" ")[0]) ||
                            tokens.includes(ngram_list[i].split(" ")[1]))) {
                        totalcount += 1
                    }
                }
                // IF VISIT
                if (id == "visitback") {
                    // tinycolor = "#b3e5fc"
                    tinycolor = "rgba(179, 229, 252, 0.3)"
                    for (var j = 0; j < 13; j++) {
                        x_array[j].style.backgroundColor = tinycolor
                        x_array[j].style.visibility = "visible"
                    }
                    var met_width = calc_tiny_visit("ngram", proposal_data.ngrams[i].ngram,
                        totalcount)
                    // console.log(met_width)
                    tinymove("met_" + proposal_data.ngrams[i].ngram, met_width)
                } else if (id == "coverback") {
                    // tinycolor = "#c8e6c9" 
                    tinycolor = "rgba(200, 230, 201, 0.3)"
                    for (var j = 0; j < 13; j++) {
                        x_array[j].style.backgroundColor = tinycolor
                        x_array[j].style.visibility = "visible"
                    }
                    var met_width = calc_tiny_cover("ngram",
                        proposal_data.ngrams[i].ngram, totalcount)
                    // console.log(met_width)
                    tinymove("met_" + proposal_data.ngrams[i].ngram, met_width)
                } else if (id == "distback") {
                    // tinycolor = "#ffcdd2"
                    tinycolor = "rgba(255, 205, 210, 0.3)"
                    for (var j = 0; j < 13; j++) {
                        x_array[j].style.backgroundColor = tinycolor
                        x_array[j].style.visibility = "visible"
                    }
                    var met_width = calc_tiny_dist("ngram",
                        proposal_data.ngrams[i].ngram, totalcount)
                    // console.log(met_width)
                    tinymove("met_" + proposal_data.ngrams[i].ngram, met_width)
                }
            }

            for (var i in proposal_data.discourses) {
                // IF VISIT
                if (id == "visitback") {
                    var met_width = calc_tiny_visit("discourse", proposal_data.discourses[i]
                        .discourse_name,
                        proposal_data.discourses[i].count)
                    // console.log(met_width)
                    tinymove("met_" + proposal_data.discourses[i].discourse_name, met_width)
                } else if (id == "coverback") {
                    var met_width = calc_tiny_cover("discourse", proposal_data.discourses[i]
                        .discourse_name,
                        proposal_data.discourses[i].count)
                    // console.log(met_width)
                    tinymove("met_" + proposal_data.discourses[i].discourse_name, met_width)
                } else if (id == "distback") {
                    var met_width = calc_tiny_dist("discourse", proposal_data.discourses[i]
                        .discourse_name,
                        proposal_data.discourses[i].count)
                    // console.log(met_width)
                    tinymove("met_" + proposal_data.discourses[i].discourse_name, met_width)
                }
            }

            // if (prev_selected_id_metric == selected_id_metric) {
            //     console.log("if", prev_selected_id_metric, selected_id_metric)
            //     document.getElementById(selected_id_metric).setAttribute("style",
            //         "border: solid thin lightgrey; width:100%")

            //     selected_id_metric = ""
            //     prev_selected_id_metric = ""

            //     for (var i = 0; i < 13; i++) {
            //         console.log("display check none")
            //         x_array[i].style.backgroundColor = "red"
            //         x_array[i].style.visibility = "hidden"
            //     }

            // } else {
            //     document.getElementById(selected_id_metric).setAttribute("style",
            //         "border: solid 2px goldenrod; width:100%")

            //     console.log("else", prev_selected_id_metric, selected_id_metric)

            //     if (id == "visitback") {
            //         tinycolor = "#b3e5fc"
            //     } else if (id == "coverback") {
            //         tinycolor = "#c8e6c9"
            //     } else if (id == "distback") {
            //         tinycolor = "#ffcdd2"
            //     }

            //     for (var i = 0; i < 13; i++) {
            //         x_array[i].style.backgroundColor = tinycolor
            //         x_array[i].style.visibility = "visible"
            //     }

            //     proposal_data = full_data[did]

            //     var ngram_list = []

            //     for (var i in proposal_data.ngrams) {
            //         ngram_list.push(proposal_data.ngrams[i].ngram)
            //     }

            //     for (var i in ngram_list) {
            //         var totalcount = 0
            //         for (var j in proposal_data.comments) {
            //             var tokens = proposal_data.comments[j].comment.toLowerCase().split(" ");

            //             if ((tokens.includes(ngram_list[i].split(" ")[0]) ||
            //                     tokens.includes(ngram_list[i].split(" ")[1]))) {
            //                 totalcount += 1
            //             }
            //         }
            //         // IF VISIT
            //         var met_width = calc_tiny_visit("ngram", proposal_data.ngrams[i].ngram,
            //             totalcount)
            //         console.log(met_width)
            //         tinymove("met_" + proposal_data.ngrams[i].ngram, met_width)
            //     }

            //     for (var i in proposal_data.discourses) {
            //         // IF VISIT
            //         var met_width = calc_tiny_visit("discourse", proposal_data.discourses[i].discourse_name,
            //             proposal_data.discourses[i].count)
            //         console.log(met_width)
            //         tinymove("met_" + proposal_data.discourses[i].discourse_name, met_width)
            //     }

            //     if (prev_selected_id_metric) {
            //         document.getElementById(prev_selected_id_metric).setAttribute("style",
            //             "border: solid thin lightgrey; width:100%"
            //         )
            //     }

            //     prev_selected_id_metric = selected_id_metric
            // }
        }
    });

    $(document).on('mouseout', '.metbar', function () {
        if (did) {
            var x_array = document.getElementsByClassName("tinybar")

            var tinycolor = ""
            var id = $(this)[0].id
            selected_id_metric = id

            document.getElementById(selected_id_metric).setAttribute("style",
                "border: solid thin lightgray; width:100%")

            for (var i = 0; i < 13; i++) {
                x_array[i].style.backgroundColor = tinycolor
                x_array[i].style.visibility = "hidden"
            }
        }
    });
</script>